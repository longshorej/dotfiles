#!/bin/bash

sudo docker ps > /dev/null 2>&1

if [ $? -ne 0 ]; then
  echo "cannot connect to docker"
  exit 1
fi

if [ $# -ne 1 ]; then
  echo "usage: $0 <name>"
  exit 2
fi

sudo docker inspect "$1" > /dev/null 2>&1

if [ $? -ne 0 ]; then
  sudo docker create --name "$1" -v "/:/mnt/host" jsl_docker
fi

RUNNING=`sudo docker inspect -f '{{ .State.Running }}' "$1"`

if [ "$RUNNING" == "false" ]; then
  sudo docker start "$1"
fi

IP=`sudo docker inspect --format '{{ .NetworkSettings.IPAddress }}' "$1"`
PID=`sudo docker inspect --format '{{ .State.Pid }}' "$1"`

echo "$1 (pid: $PID) running on $IP (to enter: nsenter --target "$PID" --mount --uts --ipc --net --pid)
